#!/bin/bash
# kubctl-0x02
# Script for Blue-Green deployment in Kubernetes

echo "🚀 Deploying Blue (current) version..."
kubectl apply -f blue_deployment.yaml

echo "🚀 Deploying Green (new) version..."
kubectl apply -f green_deployment.yaml

echo "⏳ Waiting for Green pods to be ready..."
kubectl rollout status deployment/django-green-deployment

echo "✅ Checking Green version pods..."
kubectl get pods -l version=green -o wide

# Check logs for the green version to ensure no errors
echo "🧩 Checking logs for Green deployment..."
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs $GREEN_POD

# Ask user to switch traffic if everything looks good
echo "✅ If logs look clean, switch traffic to Green version by running:"
echo "kubectl apply -f kubeservice.yaml (after changing version selector to green)"

